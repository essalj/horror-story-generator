
import os
from _9_written_story_to_mp4 import main, create_dataframe, generate_image_prompt, get_image, text_to_speech, create_video_clip

test_story = r"C:\my\__youtube\videos\Horror_stories_test\claude_true-horror-story_1.md"
def test_flow():
    print("Starting flow test for text-to-video conversion script...")

    # # Step 1: Create a sample input file
    # print("Creating sample input file...")
    # with open("test_input.txt", "w") as f:
    #     f.write("This is a test sentence.\nHere's another line to convert.")
    
    # Step 2: Test create_dataframe
    print("Testing create_dataframe function...")
    df = create_dataframe(test_story)
    print(f"DataFrame created with {len(df)} rows.")
    print(df)

    # Step 3: Test generate_image_prompt
    print("\nTesting generate_image_prompt function...")
    sample_text = df['text'].iloc[0]
    prompt = generate_image_prompt(sample_text)
    print(f"Generated prompt: {prompt}")

    # Step 4: Test get_image
    print("\nTesting get_image function...")
    image = get_image(prompt)
    print(f"Image generated with size: {image.size}")

    # Step 5: Test text_to_speech
    print("\nTesting text_to_speech function...")
    audio_file = text_to_speech(sample_text, "test_audio.mp3")
    print(f"Audio file created: {audio_file}")

    # Step 6: Test create_video_clip
    print("\nTesting create_video_clip function...")
    image.save("test_image.png")
    clip = create_video_clip("test_image.png", audio_file, 5)
    print(f"Video clip created with duration: {clip.duration} seconds")

    # Step 7: Run the main function
    print("\nRunning the main function...")
    main("test_input.txt", "test_output.mp4")

    # Check if the output file was created
    if os.path.exists("test_output.mp4"):
        print("\nSuccess! The output video file 'test_output.mp4' was created.")
    else:
        print("\nError: The output video file was not created.")

    # Clean up
    print("\nCleaning up test files...")
    for file in ["test_input.txt", "test_audio.mp3", "test_image.png", "test_output.mp4"]:
        if os.path.exists(file):
            os.remove(file)
            print(f"Removed {file}")

if __name__ == "__main__":
    test_flow()